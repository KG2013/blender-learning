# Blender 启动时加载自定义界面

目标为只展示打扮家自定义的界面

## addons方式

- https://wiki.blender.org/wiki/Building_Blender/Mac 根据文档下载相关源码 
- 将插件的.py文件拷贝 blender/release/scripts/addons/ 
- 修改 blender/source/blender/blenkernel/intern/blendfile.c，在方法 BKE_blendfile_userdef_from_defaults中添加addons默认插件

``` c++
const char *addons[] = {
        "io_anim_bvh",
        "io_curve_svg",
        "io_mesh_ply",
        "io_mesh_stl",
        "io_mesh_uv_layout",
        "io_scene_fbx",
        "io_scene_gltf2",
        "io_scene_obj",
        "io_scene_x3d",
        "cycles",
        "pose_library",
        "view_3d_hidden_tool", /* 添加的测试插件*/
    };
```
- make 源码

## app-template

- 将app-template拷贝到blender/release/scripts/startup/bl_app_templates_system/ 下
- 修改 blender/source/blender/windowmanager/intern/wm_files.c 文件 

```c++
const char *WM_init_state_app_template_get(void)
{
  /*强制使用BlenderPro-master*/
  return wm_init_state_app_template.override ? wm_init_state_app_template.app_template : "BlenderPro-master";
}

```

```c++
static int wm_homefile_read_exec(bContext *C, wmOperator *op){
    ...
  if (prop_app_template && RNA_property_is_set(op->ptr, prop_app_template)) {
    RNA_property_string_get(op->ptr, prop_app_template, app_template_buf);

    /*强制使用BlenderPro-master*/
    const char *app_template_t = "BlenderPro-master";
    app_template = app_template_t;
    // app_template = app_template_buf; 


    if (!use_factory_settings) {
      /* Always load preferences when switching templates with own preferences. */
      use_userdef = BKE_appdir_app_template_has_userpref(app_template) ||
                    BKE_appdir_app_template_has_userpref(U.app_template);
    }

    ...

  }

    ...
}
```
- make 源码
## 注意

- 注意苹果M1芯片需要下载darwin_arm64才能进行编译 下载方式：svn checkout https://svn.blender.org/svnroot/bf-blender/trunk/lib/darwin_arm64/
- 缓存需要清除 blender-git/build_darwin 编译文件 &  Library/Application Support/Blender/X.X 用户配置文件